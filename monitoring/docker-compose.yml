version: '3'
services:
  foundation-dashboard:
    image: python:3.11-slim
    working_dir: /workspace
    environment:
      TELEMETRY_ENDPOINT: ${TELEMETRY_ENDPOINT:-http://host.docker.internal:9898/metrics}
      REFRESH_INTERVAL: ${REFRESH_INTERVAL:-5}
      FOUNDATION_DASHBOARD_PORT: "8088"
    volumes:
      - ..:/workspace:ro
    command: >-
      bash -c "mkdir -p monitoring/output &&
               while true; do
                 python monitoring/tools/render_foundation_dashboard.py \"${TELEMETRY_ENDPOINT}\" || true;
                 sleep ${REFRESH_INTERVAL};
               done &
               python -m http.server ${FOUNDATION_DASHBOARD_PORT} --bind 0.0.0.0 --directory monitoring/output"
    ports:
      - "8088:8088"
